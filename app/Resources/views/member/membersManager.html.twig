{% extends 'layoutLogin.html.twig' %}

{% block javascript %}
    <script type="text/javascript">
        $(function(){
            $('#addStatus').on('click', function(e){
                e.preventDefault();

                swal({
                    title: Translator.trans("app.member.status.add.title"),
                    text: "",
                    type: 'input',
                    showCancelButton: true,
                    closeOnConfirm: false,
                    animation: "slide-from-top",
                    confirmButtonText: Translator.trans("app.commom.validBtn"),
                    cancelButtonText: Translator.trans("app.commom.cancelBtn"),
                }, function(inputValue){
                    $.ajax({
                        'type': 'post',
                        'dataType': 'json',
                        'data': 'label='+inputValue,
                        'success': function(data){
                            var title = Translator.trans('app.common.errorTitle');
                            if(data.code == 'success'){
                                title = Translator.trans('app.common.deleteTitle');

                                reloadMemberStatusList();
                            }

                            swal(title, data.message, data.code);
                        },
                        'error': function(){
                            swal(Translator.trans("app.common.errorTitle"), Translator.trans("app.common.errorUnknow"), "error");
                        }
                    });
                });
            });

            $('#addGroup').on('click', function(e){
                e.preventDefault();

                swal({
                    title: "Ajouter un groupe",
                    text: "",
                    type: 'input',
                    showCancelButton: true,
                    closeOnConfirm: false,
                    animation: "slide-from-top",
                    confirmButtonText: "Valider",
                    cancelButtonText: "Annuler",
                }, function(inputValue){
                    console.log("You wrote", inputValue);
                });
            });

            $('.editStatus').on('click', function(e){
                e.preventDefault();

                var label = $(this).data('label');

                swal({
                    title: "Modifier le statut",
                    text: "",
                    type: 'input',
                    inputValue: label,
                    showCancelButton: true,
                    closeOnConfirm: false,
                    animation: "slide-from-top",
                    confirmButtonText: "Valider",
                    cancelButtonText: "Annuler",
                }, function(inputValue){
                    console.log("You wrote", inputValue);
                });
            });

            $('.editGroup').on('click', function(e){
                e.preventDefault();

                var label = $(this).data('label');

                swal({
                    title: "Modifier le groupe",
                    text: "",
                    type: 'input',
                    inputValue: label,
                    showCancelButton: true,
                    closeOnConfirm: false,
                    animation: "slide-from-top",
                    confirmButtonText: "Valider",
                    cancelButtonText: "Annuler",
                }, function(inputValue){
                    console.log("You wrote", inputValue);
                });
            });


            $('.delMember').on('click', function(e){
                e.preventDefault();

                var id = $(this).data('id');

                swal({
                    title: "Êtes-vous sûr ?",
                    text: "La suppression du membre est définitf !",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "Oui, je veux le supprimer !",
                    cancelButtonText: "Non, n'annule ma demande !",
                    closeOnConfirm: false,
                    closeOnCancel: true
                },
                function(isConfirm){
                    if (isConfirm) {
                        swal("Supprimé !", "Le membre a été supprimé.", "success");
                    }
                });
            });

            $('.delStatus').on('click', function(e){
                e.preventDefault();

                var id = $(this).data('id');

                swal({
                        title: "Êtes-vous sûr ?",
                        text: "La suppression du status est définitf !",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "Oui, je veux le supprimer !",
                        cancelButtonText: "Non, n'annule ma demande !",
                        closeOnConfirm: false,
                        closeOnCancel: true
                    },
                    function(isConfirm){
                        if (isConfirm) {
                            swal("Supprimé !", "Le status a été supprimé.", "success");
                        }
                    });
            });

            $('.delGroup').on('click', function(e){
                e.preventDefault();

                var id = $(this).data('id');

                swal({
                        title: "Êtes-vous sûr ?",
                        text: "La suppression du groupe est définitf !",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "Oui, je veux le supprimer !",
                        cancelButtonText: "Non, n'annule ma demande !",
                        closeOnConfirm: false,
                        closeOnCancel: true
                    },
                    function(isConfirm){
                        if (isConfirm) {
                            swal("Supprimé !", "Le groupe a été supprimé.", "success");
                        }
                    });
            });
        });

        function reloadMemberStatusList(){
            var $memberStatusContainer = $('#memberStatusContainer');
            var paginatorPageParam = $memberStatusContainer.data('page-parameter-name');
            var nbRow = $memberStatusContainer.find('table tbody tr').length;
            var url = window.location.href;

            var regExp = new RegExp(".*"+paginatorPageParam+"=(\\d+).*","gi");

            var pageTag = regExp.exec(url);

            var pageCount = 1;
            if(null !== pageTag){
                var pageCount = parseInt(pageTag.length > 1? pageTag[1]: 1);
            }

            if(nbRow ==  1 && pageCount > 1){
                pageCount = pageCount -1;
            }

            $.ajax({
                'url': Routing.generate('member_status_list_part'),
                'type': 'GET',
                'data': paginatorPageParam+'='+pageCount,
                'dataType': 'html',
                'success': function(template){
                    $('#memberStatusContainer').html(template);
                },
                'error': function(){
                    swal(Translator.trans('app.common.errorTitle'),
                        Translator.trans('app.common.errorUnknow'), "error");
                }
            });
        }

    </script>

{% endblock %}

{% block content %}
    <div class="row block-header">
        {% include 'main/breadcrumb.html.twig' with {'breadcrumbs': [
        {
        'href': path('dashboard'),
        'title': 'app.dashboard.callback'|trans,
        'label': 'app.dashboard.title'|trans
        },
        {
        'label': 'app.member.member.list.title'|trans
        }
        ] } %}

        <h2 class="col-xs-12">
            {{ 'app.member.member.list.title'|trans }}
            <span class="pull-right">40 membres</span>
        </h2>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <div class="card">
                <div class="body">
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs tab-nav-right" role="tablist">
                        <li role="presentation" class="active"><a href="#members" data-toggle="tab">Liste des adhérents</a></li>
                        <li role="presentation"><a href="#status" data-toggle="tab">Statuts</a></li>
                        <li role="presentation"><a href="#groups" data-toggle="tab">Groupes</a></li>
                    </ul>

                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane fade in active" id="members">
                            {% include 'member/manager/membersList.html.twig' %}
                        </div>
                        <div role="tabpanel" class="tab-pane fade" id="status">
                            {{ render(controller('AppBundle:MemberStatus:list')) }}
                            {#{% include 'member/manager/statusList.html.twig' %}#}
                        </div>
                        <div role="tabpanel" class="tab-pane fade" id="groups">
                            {% include 'member/manager/groupsList.html.twig' %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}